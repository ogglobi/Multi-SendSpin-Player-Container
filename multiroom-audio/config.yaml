name: Multi-Room Audio Controller
version: "4.0.0"
slug: multiroom-audio
description: >-
  Sendspin-powered multi-room audio controller. Stream audio from Music
  Assistant to USB DACs connected to your Home Assistant server.
url: https://github.com/chrisuthe/Multi-SendSpin-Player-Container
image: ghcr.io/chrisuthe/multiroom-audio-hassio
startup: services
arch:
  - amd64
  - aarch64

# Hardware access
audio: true
host_network: true
udev: true
uart: true
usb: true
# Explicit device mapping for audio access
devices:
  - "/dev/snd:/dev/snd"

# Full system access (matching squeezelite for debugging)
# TODO: Remove once we identify minimum required permissions
full_access: true

# Permissions for audio processing
privileged:
  - SYS_NICE
  - SYS_ADMIN   # Broad system admin (squeezelite uses this)
  - SYS_PTRACE  # Process tracing (squeezelite uses this)
  - IPC_LOCK    # Lock memory pages - prevents swap, critical for RT audio
apparmor: false  # Disabled with full_access

# Storage mapping
map:
  - config:rw
  - share:rw

# Web interface via ingress only (no direct port exposure)
ingress: true
ingress_port: 8096
panel_icon: mdi:speaker-multiple
panel_title: Multi-Room Audio

# User-configurable options
options:
  log_level: info
  mock_hardware: false
  enable_advanced_formats: false
  relay_serial_port: null
  relay_devices: []

schema:
  log_level: list(debug|info|warning|error)
  mock_hardware: bool
  enable_advanced_formats: bool
  relay_serial_port: device(subsystem=tty)?
  relay_devices:
    - str?

# Watchdog - auto-restart if health check fails
watchdog: http://[HOST]:[PORT:8096]/api/health

# Build stage - use 'stable' for visibility, 'experimental' hides unless enabled
stage: stable
init: false
